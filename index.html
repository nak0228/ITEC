<!doctype html>
<!--[if lt IE 7]> <html class="ie6 oldie"> <![endif]-->
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ページITEC2021 サーバ技術部第3課発表</title>
<meta name="description" content="ページの説明を記入します。">
<link rel="stylesheet" type="text/css" href="mit/normalize.css">
<link rel="stylesheet" type="text/css" href="style.css">
<script src="mit/jquery-1.9.1.min.js"></script>
<script src="script.js"></script>
<!--[if lt IE 9]>
<script src="mit/html5shiv.js"></script>
<script src="mit/respond.min.js"></script>
<![endif]-->
</head>
<body>



<header id="0">
<div class="max_width">
<p id="menu_button"><img src="images/menu-button.png" alt="メニューボタン" /></p>
<p id="site_title">Deep Learningを用いた動画の修復</p>
<nav id="nav">
<ul>
 <li><a href="#0">トップ</a></li>
 <li><a href="#1">はじめに</a></li>
 <li><a href="#2">修復ツールについて</a></li>
 <li><a href="#3">修復結果</a></li>
 <li><a href="#4">修復ツールの使い方</a></li>

</ul>
</nav>
</div><!-- max_width -->
</header>





<!-- ブロック1 ここから -->
<div class="content_wrap1" id="1">
<div class="max_width">
<article class="content">
<h1>はじめに</h1>
<p><b>ITECの皆さん、お疲れ様です！</b></p>
<p>このWebページはサーバ技術部第3課の発表を補足するために用意されたものです。</p>
<p>我々の発表テーマである、「Deep Learningを用いた動画の修復」では、Google Colaboratoryという Pythonの開発環境を使って、古い動画や低画質の動画の高精細化にチャレンジしています。
プレゼンの中で修復結果をお見せしたかったのですが、Zoomではスムーズに表示できなかったため、このページから修復結果をみれるようにしました。</p>
<p><b>また、この修復を行うために作成したPythonスクリプトをGithub上で公開しましたので、その簡単な使い方についても説明しています。ご興味のある方はぜひ使ってみてください！</b></p> 
</article>
</div><!-- max_width -->
</div><!-- content_wrap1 -->
<!-- ブロック1 ここまで -->





<!-- ブロック2 ここから -->
<div class="content_wrap2" id="2">
<div class="max_width">
<article class="content">
<h1>修復ツールについて</h1>
<p>ここではGoogle Colaboratory上で開発された動画修復ツールについて簡単に説明します。</p>
<p>このツールはYoutube等のオンライン動画やPC内にある動画ファイルを、複数のDeepLearningライブラリを使って修復します。</P>
<p>機能の一覧とそれに使用したライブラリは以下の表を参照してください。</p>
<p><img src="images/table.jpg" alt="table" class="img_frame"/></p>
<p>処理は「超解像度化」→「カラー化」→「ノイズ低減」→「顔画像の修復」→「フレーム補間」の順に処理されます。ただし全ての処理を実行すると修復に大量の時間がかかるため、必要な機能のみを選択して実行できるようにしています。</p>
<p>各処理の実行結果はそれぞれGoogle Driveにコピーされるようになっています。最終結果はFinal_output.mp4という名前で保存される他、オリジナル画像と最終結果の比較動画がcomparison_output.mp4（フレーム補間を有効にするとこのファイルは作られません）という名前で作成されます。</p>
<p><img src="images/flow.jpg" alt="process flow" class="img_frame"/></p>
</article>
</div><!-- max_width -->
</div><!-- content_wrap2 -->
<!-- ブロック2 ここまで -->





<!-- ブロック3 ここから -->
<div class="content_wrap1" id="3">
<div class="max_width">
<article class="content">
<h1>修復結果</h1>
<p>今回の発表のために著作権が切れた映画の修復を行いました。</p>
<p>使用した映画は「ローマの休日」、「東京物語」、「カサブランカ」の3本です。それぞれ修復前後でどのように変わったかをご確認下さい。</p>
	
<h2><b>1. ローマの休日（Roman Holiday）</b></h2>
<hr><br>
<h3><b>オリジナル動画</b></h3>
<br>
<p>まず最初にご覧いただくのは、ローマの休日です。以下の画像はモノクロのオリジナル版です。これを今回開発したツールでカラー化してみます。</p>
<video id="player" controls width=960>
    <source src="roman_holiday_last_scene_original.mp4" type="video/mp4">
</video>
<br><br>
<h3><b>カラー化後</b></h3>
<p>先ほどの動画を1080pに拡大した後、カラー化したのが以下の動画です。色付けは全てAIが自動的に行っています。そのため、オリジナルの色を正確に再現できるわけではありませんが、それほど不自然なところもなく色付けすることができました。</p>
<video id="player" controls width=960>
    <source src="roman_holiday_last_scene_colorized_only.mp4" type="video/mp4">
</video>
<br><br>
<h3><b>顔修正後</b></h3>
<p>次に先ほどの動画の顔の部分を、マイクロソフトが開発したBringing-Old-Photo-back-to-Lifeというライブラリを使って修復しました。カラー化しただけの時と比べて顔全体が鮮明になっていることがわかります。</p>
<p>興味深いことに、オードリー・ヘップバーンの左後ろにいる人（完全にピンボケなのですが）を認識して、うっすらと目が書き加えらているのがわかります。
<video id="player" controls width=960>
    <source src="roman_holiday_last_scene_final.mp4" type="video/mp4">
</video>
<br><br>
<h2>2. 東京物語（Tokyo Story）</h2>
<hr><br>
次の動画は日本映画の最高傑作と言われている、小津安二郎監督の「東京物語」です。
<br><br>
<h3>オリジナル動画</h3>
<video id="player" controls width=960>
    <source src="tokyo_story_original.mp4" type="video/mp4">
</video>
<br><br>
<h3>修復結果</h3>
<p>こちらの動画もうまく修正することができました。ただ21秒付近で顔の一部が欠ける現象が発生しています。これは顔の輪郭と背景の明暗がほぼ同じになったため、AIが輪郭を正確に判断できなかったためと推測されます。</p>
<video id="player" controls width=960>
    <source src="tokyo_story.mp4" type="video/mp4">
</video>
<br><br>
<h2>3. カサブランカ（Casablanca）</h2>
<hr><br><br>
<h3>修復前後の比較</h3>
<p>最後はハンフリー・ボガードとイングリッド・バーグマンが共演した「カサブランカ」の有名なシーンです。</br>
<p>本ツールでは修復する前、修復した後の動画を並べて比較する動画を作ることができます。このままだと少し画面が小さくて見づらいので、動画の右下にある四角い拡大ボタン（音量アイコンの隣）を押して、大きな画面で見てください</p>
<video id="player" controls width=960>
    <source src="casablanca_comparison.mp4" type="video/mp4">
</video>
	
</article>
</div><!-- max_width -->
</div><!-- content_wrap1 -->
<!-- ブロック3 ここまで -->





<!-- ブロック4 ここから -->
<div class="content_wrap2" id="4">
<div class="max_width">
<article class="content">
<h1>動画修復ツールの使い方</h1>
<p>それでは今回作成した動画修復ツールの使い方を説明します。</p>
<p>このツールはGoogleが提供しているGoogle ColaboratoryというブラウザベースのPython開発環境上で作成されています。Google Chromeを使える環境であれば、どこからでも利用することができます。なお、このツールでは修復した動画を管理するために、Google Driveが利用できる必要があります。</p>
<p>まず初めに以下のURLをクリックして、Github上の修復ツール画面を開いてください。</p>
<br><br>
<p><b><a href="https://github.com/nak0228/ITEC/blob/main/VideoRestore.ipynb" target="_blank" rel="nofollow">動画修復ツール（Google Colaboratory）</b></a></p>
<br><br>
<p>以下のような画面が表示されたら、画面中央の「Open in Colab」(赤枠部分）と書かれたアイコンをクリックしてください。</p>
<br>
<p><img src="images/github-colab.jpg" alt="open-in-colab" class="img_frame"/></p>
<br>
<p>アイコンをクリックするとGoogle Colaboratoryに移動し、下図のような動画修復ツールのコードが表示されます。この画面、AIの開発で頻繁に利用されるJupyter Notebookというツールをベースにしています。そのため一般的なWeb GUIとは趣が異なります。とはいえ心配は無用です。</p>
<p>Google Golaboratoryでは画面の左にある「▶」(赤丸部分）のアイコンをクリックすることでコマンドが実行されるようになっています。まずは画面最初の方にある「GPUの確認」というところにある「▶」アイコンをクリックしてみましょう</p>
<br><br>
<p><img src="images/colab-first-page.jpg" alt="first colab page" class="img_frame"/></p>	
<br>
<p>すると以下のようなダイアログボックスが表示されるので、「このまま実行」をクリックしてください。</p>
<p><img src="images/startup-diagram.jpg" alt="startup diagram" class="img_frame"/></p>	
<p>この時、「ノートブックにはハイメモリが必要です」という表示が出た場合は、「OK」をクリックしてください。修復する動画によってはメモリ不足で終了する可能性がありますが、ハイメモリを有効にするにはGoogle Colaboratoryを有償版にアップグレードする必要があるため、このまま進めます。</p>
<p><img src="images/HighMemory.jpg" alt="startup diagram" class="img_frame"/></p>		
<br>
<p>続いて「フラグの設定と最低限必要なライブラリのインポート」や「Googleドライブのマウント」の横にある「▶」アイコンを順にクリックしてください。</p>
<p>「Googleドライブのマウント」の横にある「▶」をクリックすると以下のようなダイアログが表示されるので、ここで使用するアカウントを選択します。</p>
<br>
<p><img src="images/account-selection.jpg" alt="google drive account" class="img_frame"/></p>
<br>
<p>以下のような画面が表示されたら、選択したアカウントを使ってGoogle Driveをマウントするために「許可」をクリックしてください。</p>
<br>
<p><img src="images/google-drive-accept.jpg" alt="google drive accept" class="img_frame"/></p>	
<br>
<h2>プロジェクト名の入力</h2>
<p>プロジェクト名を入力し終わったら、再度画面左にある「▶」(赤丸部分）のアイコンをクリックしてください。先ほどマウントしたGoogle Driveの下にMovieというフォルダが作られ、その下にプロジェクト名で指定したフォルダが作成されます。本ツールで修正したファイル群がこのフォルダの中に保存されます。</p>
<p><img src="images/project-name.jpg" alt="video download" class="img_frame"/></p>
<hr>
<h2>ビデオのダウンロード</h2>
<p>修正したいビデオのURLを指定し終わったら、再度画面左にある「▶」(赤丸部分）のアイコンをクリックしてください。指定したURLからファイルがダウンロードされ、downloaded_video.mp4という名前で保存されます。このフィールドを空白にした場合、ローカルPCにあるファイルをダウンロードします。</p>
<p><img src="images/video-download.jpg" alt="video download" class="img_frame"/></p>	
<hr>
<h2>動画の調整</h2>
<p>ここではダウンロードした動画のどの部分を修復するか（修復範囲の指定）、モノクロ動画のカラー化を行うかなどを指定します。</p>
<p><img src="images/movie_config.jpg" alt="video download" class="img_frame"/></p>	
<h3>1．修復範囲の指定</h3>
<p>修復する範囲の開始時間と終了時間を例えば00:01:00 や 00:02:30 のように指定します。この場合、ダウンロードした動画の開始1分～2分30秒の間が修復対象となります。このフィールドはを空白にすることはできません。また数字は全て半角で入力してください。</p>
<h3>2. モノクロ動画のカラー化</h3>
<p>モノクロ動画をカラー化する場合は、is_deoldifyと書かれた部分の右側にあるチェックボックスを有効化します。その下のレンダリングファクターを調整することで、彩色の度合いが変化します。一般的に10～25がお勧めですが、出来上がった動画を見て最適な値に調整してください。</p>
<h3>3. ノイズ除去</h3>
<p>ノイズが多い動画を修正する場合は、is_DeepRemasterと書かれた部分の右側にあるチェックボックスを有効化します。</p>
<h3>4. 顔画像の修復</h3>
<p>動画の中から顔を検出し、それを入力として新たな顔を生成し元の画像と挿げ替えます。マイクロソフトが開発した「Bringing-Old-Photo-back-to-Life」（メニュー上はMicrosoftと表記）またはテンセントが開発したGFPGANをプルダウンメニューから選択します</p>
<h3>5. フレーム補間</h3>	
<p>動画のフレーム数を増やす場合、is_DAINと書かれた部分の右側にあるチェックボックスを有効化します。フレーム数は元の画像の2倍に増えますが、映像と音声にずれが生じたり、シーンが切り替わるときに異なる画像から中間フレームを生成することで画面が乱れる可能性があります。</p>

<hr>
<h2>サイズ調整後の動画を表示（修復対象）</h2>
<p>動画の修復部分が正しいかを確認するために、プレビューします。what_nextの右側のプルダウンメニューから、「play（プレビューの表示）」もしくは「download（修復対象動画のダウンロード）」を選択したら、画面左にある「▶」(赤丸部分）のアイコンをクリックしてください。</p>
<p><img src="images/preview.jpg" alt="video download" class="img_frame"/></p>		
<hr>
<h2>修復プロセスの実行</h2>
<p>以上で修復に必要な準備が整いました。画面上にあるメニューバーから「ランタイム（またはRuntime）」をクリックして、「以降のセルを実行（またはRun after)」を選択してください。すると残りの処理が実行され、結果ファイルがGoogle Driveの中のMovieというフォルダにコピーされます。</p>
<p>なお、修復処理に時間がかかりすぎるとGoogle Colaboratoryが勝手に処理を中断してしまうことがあります。無償版のGoogle Colaboratoryでは、できるだけ修復する動画を短く（数秒程度）に抑えることをお勧めします。</p>	
<p><img src="images/doit.jpg" alt="run after" class="img_frame"/></p>		

<hr>
<h2>最後に</h2>
<p>以上で修復ツールの使い方の説明は終わりです。</p>
<p>Google Colaboratoryの情報はインターネットで大量に見つかるので、使い方がわからないことがあれば確認してみてください。</p>
</article>
</div><!-- max_width -->
</div><!-- content_wrap2 -->
<!-- ブロック4 ここまで -->








<!-- ブロック6 の作り方
<div class="content_wrap2" id="6">
<div class="max_width">
<article class="content">
<h1>ブロック6</h1>
<p>ブロック6 を追加した例です。（コメントアウトにより、ブラウザには表示されません）</p>
<p>例えば、ブロック5 をコピーした場合は、変更箇所は以下の2つです。</p>
<p>content_wrap1 を content_wrap2 に変更してください。（背景色が交互になります）</p>
<p>id="5" を id="6" に変更してください。（nav をクリックした時にジャンプする位置です）</p>
</article>
</div>
</div>
-->





<div class="footer_wrap">
<div class="max_width">
<footer>
<p>Copyright(C)2014 サイト名</p> 

<!-- 下の行を変更したり削除すると、無料テンプレートの利用規約違反となります。 -->
<p><a href="http://japanism.info/free-template.html" target="_blank" rel="nofollow">Free Template</a></p>
<!-- 上の行を変更したり削除すると、無料テンプレートの利用規約違反となります。 -->

</footer>
</div><!-- max_width -->
</div><!-- footer_wrap -->
</body>
</html>
